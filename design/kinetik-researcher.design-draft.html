<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>KinetixAI - Native Prototype</title>
<style>
    /* --- CSS RESET & VARIABLES --- */
    :root {
        --primary: #1e3a8a; /* Blue 900 */
        --primary-hover: #172554;
        --bg-color: #f8fafc; /* Slate 50 */
        --card-bg: #ffffff;
        --text-main: #1e293b; /* Slate 800 */
        --text-muted: #64748b; /* Slate 500 */
        --border: #e2e8f0;
        --success: #10b981;
        --warning: #f59e0b;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }
    
    body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        background-color: var(--bg-color);
        color: var(--text-main);
        line-height: 1.5;
        padding-bottom: 80px;
    }

    /* --- LAYOUT UTILS --- */
    .container { max-width: 1024px; margin: 0 auto; padding: 0 20px; }
    .flex { display: flex; }
    .flex-col { flex-direction: column; }
    .items-center { align-items: center; }
    .justify-between { justify-content: space-between; }
    .justify-center { justify-content: center; }
    .justify-end { justify-content: flex-end; }
    .gap-2 { gap: 0.5rem; }
    .gap-4 { gap: 1rem; }
    .gap-6 { gap: 1.5rem; }
    .grid { display: grid; grid-template-columns: 1fr; gap: 1.5rem; }
    @media(min-width: 768px) { .grid-cols-3 { grid-template-columns: repeat(3, 1fr); } }
    .hidden { display: none !important; }
    .w-full { width: 100%; }
    .h-full { height: 100%; }

    /* --- COMPONENTS --- */
    .btn {
        display: inline-flex; align-items: center; justify-content: center;
        padding: 0.6rem 1.2rem; border-radius: 0.5rem; font-weight: 500; cursor: pointer; transition: all 0.2s;
        border: 1px solid transparent; font-size: 0.95rem;
    }
    .btn-primary { background-color: var(--primary); color: white; box-shadow: 0 4px 6px -1px rgba(30, 58, 138, 0.1); }
    .btn-primary:hover { background-color: var(--primary-hover); }
    .btn-secondary { background-color: white; border-color: #cbd5e1; color: var(--text-main); }
    .btn-secondary:hover { background-color: #f1f5f9; }
    .btn-ghost { background-color: transparent; color: var(--text-muted); }
    .btn-ghost:hover { background-color: #f1f5f9; color: var(--text-main); }
    .btn:disabled { opacity: 0.5; cursor: not-allowed; }

    .card {
        background: var(--card-bg); border-radius: 0.75rem;
        box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1); border: 1px solid var(--border);
        overflow: hidden;
    }
    .card-header { padding: 1rem 1.5rem; border-bottom: 1px solid var(--border); background-color: #f8fafc; display: flex; justify-content: space-between; align-items: center; }
    .card-body { padding: 1.5rem; }

    /* --- HEADER --- */
    header { background: white; border-bottom: 1px solid var(--border); padding: 1rem 0; position: sticky; top: 0; z-index: 50; }
    .logo-box { width: 40px; height: 40px; background: linear-gradient(135deg, #1e3a8a, #1e40af); border-radius: 8px; display: flex; align-items: center; justify-content: center; color: white; margin-right: 12px; }

    /* --- STEPPER --- */
    .stepper-container { background: white; border-bottom: 1px solid var(--border); padding: 1.5rem 0; margin-bottom: 2rem; }
    .stepper { display: flex; justify-content: space-between; position: relative; max-width: 900px; margin: 0 auto; }
    .step-item { display: flex; flex-direction: column; align-items: center; position: relative; z-index: 10; flex: 1; }
    .step-line { position: absolute; top: 20px; left: 0; width: 100%; height: 2px; background: #e2e8f0; z-index: 0; }
    .step-line-fill { position: absolute; top: 20px; left: 0; height: 2px; background: var(--primary); z-index: 1; transition: width 0.3s ease; }
    
    .step-circle { 
        width: 40px; height: 40px; border-radius: 50%; background: white; border: 2px solid #e2e8f0; 
        display: flex; align-items: center; justify-content: center; font-weight: bold; color: #94a3b8;
        transition: all 0.3s ease; margin-bottom: 0.5rem;
    }
    .step-item.active .step-circle { border-color: var(--primary); background: var(--primary); color: white; transform: scale(1.1); box-shadow: 0 0 0 4px rgba(30, 58, 138, 0.1); }
    .step-item.completed .step-circle { border-color: var(--success); background: var(--success); color: white; }
    .step-label { font-size: 0.75rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.05em; color: #94a3b8; }
    .step-item.active .step-label { color: var(--primary); }

    /* --- ANIMATIONS --- */
    .fade-in { animation: fadeIn 0.4s ease-out forwards; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    .spin { animation: spin 1s linear infinite; }
    @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

    /* --- SPECIFIC VIEWS --- */
    .upload-zone { 
        border: 2px dashed #cbd5e1; border-radius: 1rem; padding: 4rem 2rem; 
        text-align: center; cursor: pointer; transition: all 0.2s; background: white;
    }
    .upload-zone:hover { border-color: var(--primary); background: #eff6ff; }
    
    .check-item { display: flex; justify-content: space-between; align-items: center; padding: 1rem; background: #f8fafc; border: 1px solid var(--border); border-radius: 0.5rem; margin-bottom: 0.75rem; }
    .badge { padding: 0.25rem 0.75rem; border-radius: 99px; font-size: 0.75rem; font-weight: 600; display: flex; align-items: center; gap: 0.3rem;}
    .badge-success { background: #d1fae5; color: #065f46; }
    .badge-warning { background: #fef3c7; color: #92400e; }
    .badge-loading { background: #eff6ff; color: #1e40af; }

    .group-card { border-left: 4px solid transparent; transition: transform 0.2s; }
    .group-card:hover { transform: translateY(-2px); box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); }
    
    .chat-bubble { padding: 1rem; border-radius: 1rem; max-width: 85%; font-size: 0.9rem; margin-bottom: 1rem; animation: fadeIn 0.3s; }
    .chat-bot { background: white; border: 1px solid var(--border); border-top-left-radius: 0; align-self: flex-start; margin-right: auto; }
    .chat-user { background: #1e293b; color: white; border-top-right-radius: 0; align-self: flex-end; margin-left: auto; }
</style>
</head>
<body>

    <!-- Header -->
    <header>
        <div class="container flex items-center justify-between">
            <div class="flex items-center">
                <div class="logo-box">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 2v7.31l-6.29 10.83a2 2 0 0 0 1.73 2.86h13.12a2 2 0 0 0 1.73-2.86L14 9.31V2 M8.5 2h7 M10 16h4"/></svg>
                </div>
                <div>
                    <h1 style="font-size: 1.25rem; font-weight: 700; line-height: 1.1;">Kinetix<span style="color: #2563eb">AI</span></h1>
                    <p style="font-size: 0.7rem; color: #64748b; font-weight: 700; letter-spacing: 0.05em; text-transform: uppercase;">Automated Analysis</p>
                </div>
            </div>
            <div class="flex items-center gap-4">
                <span style="font-size: 0.85rem; font-weight: 600; color: #334155;">Dr. J. Doe</span>
                <div style="width: 32px; height: 32px; background: #eff6ff; border: 1px solid #bfdbfe; color: #1d4ed8; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.75rem; font-weight: bold;">JD</div>
            </div>
        </div>
    </header>

    <!-- Stepper -->
    <div class="stepper-container">
        <div class="stepper">
            <div class="step-line-fill" id="progress-bar" style="width: 0%;"></div>
            <!-- Steps will be injected by JS -->
        </div>
    </div>

    <!-- Main Content -->
    <main class="container" id="app-content">
        <!-- Views will be injected here -->
    </main>

    <!-- --- JAVASCRIPT LOGIC --- -->
    <script>
        // --- STATE & DATA ---
        const state = {
            step: 0,
            file: null,
            validationStatus: 'pending',
            groups: [],
            chatMessages: []
        };

        const steps = [
            { label: 'Import', icon: `<path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/>` },
            { label: 'Validierung', icon: `<polyline points="20 6 9 17 4 12"/>` },
            { label: 'Gruppierung', icon: `<path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/>` },
            { label: 'Modellierung', icon: `<path d="M10 2v7.31l-6.29 10.83a2 2 0 0 0 1.73 2.86h13.12a2 2 0 0 0 1.73-2.86L14 9.31V2 M8.5 2h7 M10 16h4"/>` },
            { label: 'Report', icon: `<path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/>` }
        ];

        // --- RENDER HELPERS ---
        function renderIcon(path, size=20) {
            return `<svg width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">${path}</svg>`;
        }

        function updateStepper() {
            const stepperEl = document.querySelector('.stepper');
            const progressEl = document.getElementById('progress-bar');
            
            // Re-render steps if needed (or just update classes)
            // For simplicity, we just clear and rebuild the markers, but keep the bar
            const existingMarkers = stepperEl.querySelectorAll('.step-item');
            if(existingMarkers.length === 0) {
                // Initial build
                steps.forEach((s, idx) => {
                    const div = document.createElement('div');
                    div.className = 'step-item';
                    div.innerHTML = `
                        <div class="step-circle">${idx + 1}</div>
                        <span class="step-label">${s.label}</span>
                    `;
                    stepperEl.appendChild(div);
                });
            }

            const markers = document.querySelectorAll('.step-item');
            markers.forEach((m, idx) => {
                m.className = 'step-item'; // reset
                m.querySelector('.step-circle').innerHTML = idx < state.step 
                    ? renderIcon(`<polyline points="20 6 9 17 4 12"/>`, 16) 
                    : (idx === state.step ? renderIcon(steps[idx].icon, 18) : idx + 1);

                if (idx < state.step) m.classList.add('completed');
                if (idx === state.step) m.classList.add('active');
            });

            progressEl.style.width = `${(state.step / (steps.length - 1)) * 100}%`;
        }

        function setStep(newStep) {
            state.step = newStep;
            updateStepper();
            renderView();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // --- VIEWS ---

        function renderView() {
            const app = document.getElementById('app-content');
            app.innerHTML = ''; // Clear

            switch(state.step) {
                case 0: renderImport(app); break;
                case 1: renderValidation(app); break;
                case 2: renderGrouping(app); break;
                case 3: renderModeling(app); break;
                case 4: renderReporting(app); break;
            }
        }

        // STEP 1: IMPORT
        function renderImport(container) {
            const wrapper = document.createElement('div');
            wrapper.className = 'fade-in';
            
            if (!state.file) {
                wrapper.innerHTML = `
                    <div style="text-align: center; margin-bottom: 2rem;">
                        <h2 style="font-size: 1.5rem; font-weight: 700; margin-bottom: 0.5rem;">Daten importieren</h2>
                        <p style="color: var(--text-muted);">Laden Sie Ihre Rohdaten als Excel (.xlsx) oder CSV Datei hoch.</p>
                    </div>
                    <div class="upload-zone" onclick="simulateUpload()">
                        <div style="width: 64px; height: 64px; background: #eff6ff; color: var(--primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1.5rem auto;">
                            ${renderIcon(steps[0].icon, 32)}
                        </div>
                        <h3 style="font-size: 1.1rem; font-weight: 600; margin-bottom: 0.5rem;">Datei auswählen oder hier ablegen</h3>
                        <p style="font-size: 0.9rem; color: var(--text-muted);">Maximale Dateigröße 50MB</p>
                    </div>
                `;
            } else {
                wrapper.innerHTML = `
                    <div style="text-align: center; margin-bottom: 2rem;">
                        <h2 style="font-size: 1.5rem; font-weight: 700; margin-bottom: 0.5rem;">Daten importieren</h2>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <h3 style="font-weight: 600;">Spalten zuweisen (Mapping)</h3>
                            <button class="btn btn-ghost" onclick="resetFile()" style="color: #ef4444; font-size: 0.85rem;">
                                ${renderIcon('<polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>', 14)} 
                                <span style="margin-left: 6px">Entfernen</span>
                            </button>
                        </div>
                        <div class="card-body">
                            <div class="grid grid-cols-3" style="gap: 2rem;">
                                ${['Zeit-Achse (min/h)', 'Messsignal (y-Achse)', 'Experiment ID'].map((label, i) => `
                                    <div>
                                        <label style="display: block; font-weight: 600; margin-bottom: 0.5rem; font-size: 0.9rem;">${label}</label>
                                        <select style="width: 100%; padding: 0.6rem; border-radius: 0.5rem; border: 1px solid var(--border); background: #f8fafc;">
                                            <option disabled selected>Bitte wählen...</option>
                                            <option>Column A: Time [min]</option>
                                            <option>Column B: Temp [C]</option>
                                            <option>Column C: Absorbance</option>
                                        </select>
                                    </div>
                                `).join('')}
                            </div>
                            <div class="flex justify-end" style="margin-top: 2rem;">
                                <button class="btn btn-primary" onclick="startValidation()">
                                    Weiter zur Validierung 
                                    <span style="margin-left: 8px">${renderIcon('<polyline points="9 18 15 12 9 6"/>', 16)}</span>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }
            container.appendChild(wrapper);
        }

        function simulateUpload() {
            const zone = document.querySelector('.upload-zone');
            zone.innerHTML = `<div style="color: var(--primary);">${renderIcon('<path d="M21 12a9 9 0 1 1-6.219-8.56"/>', 32)}<br><br>Lade Datei...</div>`;
            zone.querySelector('svg').classList.add('spin');
            setTimeout(() => {
                state.file = { name: 'experiment_data.xlsx' };
                renderView();
            }, 1000);
        }

        function resetFile() { state.file = null; renderView(); }

        function startValidation() {
            state.validationStatus = 'scanning';
            setStep(1);
            // Simulate scan
            setTimeout(() => {
                state.validationStatus = 'valid';
                renderView();
            }, 2000);
        }

        // STEP 2: VALIDATION
        function renderValidation(container) {
            const wrapper = document.createElement('div');
            wrapper.className = 'fade-in';
            
            const checks = [
                { label: 'Dateiformat & Struktur', detail: 'Excel (.xlsx) erkannt' },
                { label: 'Numerische Konsistenz', detail: 'Spalten A, C sind numerisch' },
                { label: 'Zeitstempel-Check', detail: 'Keine Lücken gefunden' },
                { label: 'Ausreißer-Analyse', detail: '3 Anomalien markiert' }
            ];

            const isLoading = state.validationStatus === 'scanning';

            wrapper.innerHTML = `
                <div style="text-align: center; margin-bottom: 2rem;">
                    <h2 style="font-size: 1.5rem; font-weight: 700;">Daten-Check</h2>
                    <p style="color: var(--text-muted);">Qualitätssicherung läuft automatisch.</p>
                </div>
                <div class="card" style="max-width: 800px; margin: 0 auto;">
                    <div class="card-body">
                        ${checks.map((c, i) => `
                            <div class="check-item">
                                <div>
                                    <div style="font-weight: 600;">${c.label}</div>
                                    <div style="font-size: 0.8rem; color: var(--text-muted);">${c.detail}</div>
                                </div>
                                <div>
                                    ${isLoading && i > 1 ? 
                                        `<span class="badge badge-loading">${renderIcon('<path d="M21 12a9 9 0 1 1-6.219-8.56"/>', 12)} <span style="margin-left:4px">Prüfe...</span></span>` : 
                                        `<span class="badge badge-success">${renderIcon('<polyline points="20 6 9 17 4 12"/>', 12)} <span style="margin-left:4px">OK</span></span>`
                                    }
                                </div>
                            </div>
                        `).join('')}

                        ${!isLoading ? `
                            <div style="background: #eff6ff; border: 1px solid #dbeafe; padding: 1rem; border-radius: 0.5rem; display: flex; gap: 1rem; margin-top: 1.5rem;">
                                <div style="color: var(--primary);">${renderIcon('<path d="M12 2a2 2 0 0 1 2 2v2a2 2 0 0 1-2 2v0a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2Z"/><path d="M4 11v2a8 8 0 0 0 16 0v-2"/><path d="M12 22v-4"/>', 24)}</div>
                                <div>
                                    <div style="font-weight: 700; color: var(--primary); font-size: 0.9rem;">KI-Analyse</div>
                                    <p style="font-size: 0.9rem; color: #334155;">Die Datenqualität ist sehr hoch (Score: 98/100). Ich habe 3 potenzielle Ausreißer in Exp_004 gefunden, diese aber für den nächsten Schritt bereits vorselektiert.</p>
                                </div>
                            </div>
                        ` : ''}

                        <div class="flex justify-between" style="margin-top: 2rem; border-top: 1px solid var(--border); padding-top: 1.5rem;">
                            <button class="btn btn-ghost" onclick="setStep(0)">Zurück</button>
                            <button class="btn btn-primary" ${isLoading ? 'disabled' : ''} onclick="setStep(2)">
                                Abschließen
                                <span style="margin-left: 8px">${renderIcon('<polyline points="9 18 15 12 9 6"/>', 16)}</span>
                            </button>
                        </div>
                    </div>
                </div>
            `;
            container.appendChild(wrapper);
        }

        // STEP 3: GROUPING
        function renderGrouping(container) {
            const wrapper = document.createElement('div');
            wrapper.className = 'fade-in';
            
            const groups = [
                { name: 'Gruppe A: Standard (25°C)', color: '#3b82f6', items: ['Exp_001', 'Exp_003', 'Exp_005'] },
                { name: 'Gruppe B: High Temp (40°C)', color: '#f97316', items: ['Exp_002', 'Exp_004'] },
                { name: 'Ungruppiert', color: '#cbd5e1', items: ['Exp_006 (Error?)'] }
            ];

            wrapper.innerHTML = `
                <div class="flex justify-between items-end" style="margin-bottom: 2rem;">
                    <div>
                        <h2 style="font-size: 1.5rem; font-weight: 700;">Experimente gruppieren</h2>
                        <p style="color: var(--text-muted);">KI-Vorschlag basierend auf Metadaten.</p>
                    </div>
                    <button class="btn btn-secondary">Neue Gruppe +</button>
                </div>
                
                <div class="grid grid-cols-3">
                    ${groups.map(g => `
                        <div class="card group-card" style="border-left-color: ${g.color}">
                            <div class="card-header" style="padding: 0.75rem 1rem;">
                                <span style="font-weight: 600; font-size: 0.9rem;">${g.name}</span>
                                ${renderIcon('<path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>', 14)}
                            </div>
                            <div class="card-body" style="padding: 1rem; background: #f8fafc; min-height: 150px;">
                                ${g.items.map(item => `
                                    <div style="background: white; padding: 0.5rem 0.75rem; border: 1px solid var(--border); border-radius: 0.375rem; margin-bottom: 0.5rem; font-size: 0.85rem; display: flex; align-items: center; justify-content: space-between; box-shadow: 0 1px 2px rgba(0,0,0,0.05);">
                                        <span class="flex items-center gap-2">
                                            <span style="color: #94a3b8">${renderIcon('<path d="M10 2v7.31l-6.29 10.83a2 2 0 0 0 1.73 2.86h13.12a2 2 0 0 0 1.73-2.86L14 9.31V2 M8.5 2h7 M10 16h4"/>', 12)}</span>
                                            ${item}
                                        </span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `).join('')}
                </div>

                <div class="flex justify-between" style="margin-top: 2rem;">
                    <button class="btn btn-ghost" onclick="setStep(1)">Zurück</button>
                    <button class="btn btn-primary" onclick="setStep(3)">Bestätigen <span style="margin-left: 8px">${renderIcon('<polyline points="9 18 15 12 9 6"/>', 16)}</span></button>
                </div>
            `;
            container.appendChild(wrapper);
        }

        // STEP 4: MODELING
        function renderModeling(container) {
            const wrapper = document.createElement('div');
            wrapper.className = 'fade-in';
            wrapper.innerHTML = `
                <div class="grid" style="grid-template-columns: 300px 1fr; gap: 1.5rem; height: 600px;">
                    <!-- Controls -->
                    <div class="card h-full flex flex-col">
                        <div class="card-header">Fit-Parameter</div>
                        <div class="card-body flex-col" style="flex: 1; display: flex; gap: 1.5rem;">
                            <div>
                                <label style="font-weight: 600; font-size: 0.85rem; display: block; margin-bottom: 0.5rem;">Ordnung</label>
                                <div style="background: #f1f5f9; padding: 4px; border-radius: 6px; display: flex;">
                                    <button style="flex:1; padding: 6px; border:none; background:white; border-radius:4px; font-weight:600; font-size:0.8rem; box-shadow: 0 1px 2px rgba(0,0,0,0.1);">1. Ord</button>
                                    <button style="flex:1; padding: 6px; border:none; background:transparent; font-size:0.8rem; color:#64748b;">2. Ord</button>
                                </div>
                            </div>
                            <div>
                                <label class="flex items-center gap-2" style="font-size: 0.9rem; cursor: pointer; padding: 0.5rem; border: 1px solid var(--border); border-radius: 6px;">
                                    <input type="checkbox" checked> Arrhenius Korrektur
                                </label>
                            </div>
                            <div style="margin-top: auto; background: #ecfdf5; border: 1px solid #a7f3d0; padding: 1rem; border-radius: 8px;">
                                <div class="flex justify-between" style="font-size: 0.8rem; font-weight: 700; color: #065f46; margin-bottom: 0.5rem;">
                                    <span>R² SCORE</span>
                                    <span>0.985</span>
                                </div>
                                <div style="height: 6px; background: #d1fae5; border-radius: 4px; overflow: hidden;">
                                    <div style="width: 98.5%; background: #10b981; height: 100%;"></div>
                                </div>
                            </div>
                        </div>
                        <div style="padding: 1rem; border-top: 1px solid var(--border);">
                            <button class="btn btn-primary w-full" onclick="setStep(4)">Berechnen</button>
                        </div>
                    </div>

                    <!-- Chart Placeholder -->
                    <div class="card h-full flex flex-col">
                        <div class="card-header">
                            <span>Kinetischer Fit: Gruppe A</span>
                            <div style="font-size: 0.75rem; display: flex; gap: 1rem;">
                                <span class="flex items-center gap-2"><span style="width:8px; height:8px; background:#3b82f6; border-radius:50%;"></span> Daten</span>
                                <span class="flex items-center gap-2"><span style="width:8px; height:8px; background:#1e293b; border-radius:50%;"></span> Modell</span>
                            </div>
                        </div>
                        <div class="card-body" style="flex: 1; background: #f8fafc; position: relative; display: flex; align-items: flex-end; padding-bottom: 3rem; padding-left: 3rem;">
                            <!-- Simple SVG Chart -->
                            <div style="width: 100%; height: 100%; position: relative; border-left: 1px solid #cbd5e1; border-bottom: 1px solid #cbd5e1;">
                                <svg width="100%" height="100%" style="overflow: visible;">
                                    <path d="M0,300 Q200,100 500,50" fill="none" stroke="#1e293b" stroke-width="2" />
                                    <circle cx="0" cy="300" r="4" fill="#3b82f6"/>
                                    <circle cx="100" cy="180" r="4" fill="#3b82f6"/>
                                    <circle cx="200" cy="120" r="4" fill="#3b82f6"/>
                                    <circle cx="300" cy="90" r="4" fill="#3b82f6"/>
                                    <circle cx="400" cy="70" r="4" fill="#3b82f6"/>
                                </svg>
                                <div style="position: absolute; bottom: -25px; width: 100%; display: flex; justify-content: space-between; font-size: 0.75rem; color: #94a3b8;">
                                    <span>0 min</span><span>60 min</span>
                                </div>
                                <div style="position: absolute; left: -30px; top: 50%; transform: rotate(-90deg); font-size: 0.75rem; color: #94a3b8;">
                                    Konzentration [mol/L]
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            container.appendChild(wrapper);
        }

        // STEP 5: REPORT
        function renderReporting(container) {
            const wrapper = document.createElement('div');
            wrapper.className = 'fade-in';
            
            wrapper.innerHTML = `
                <div class="grid" style="grid-template-columns: 1fr 1fr; gap: 2rem;">
                    <!-- Chat Interface -->
                    <div style="display: flex; flex-direction: column; gap: 1rem; height: 500px;">
                        <h3 style="font-weight: 700;">KI-Assistent & Fazit</h3>
                        <div class="card h-full flex flex-col">
                            <div class="card-body" id="chat-window" style="flex: 1; background: #f8fafc; overflow-y: auto; display: flex; flex-direction: column; gap: 1rem;">
                                <!-- Messages go here -->
                                <div style="text-align: center; color: #94a3b8; margin-top: auto; margin-bottom: auto;" id="chat-placeholder">
                                    ${renderIcon('<path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/>', 40)}
                                    <p style="margin-top: 1rem;">Klicken Sie auf "Generieren"</p>
                                </div>
                            </div>
                            <div style="padding: 1rem; border-top: 1px solid var(--border);">
                                <button class="btn btn-primary w-full" id="gen-btn" onclick="startChat()">Report Generieren</button>
                            </div>
                        </div>
                    </div>

                    <!-- PDF Preview -->
                    <div class="card h-full flex flex-col" style="background: white; border-color: #e2e8f0; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);">
                        <div style="background: #1e293b; color: white; padding: 0.75rem 1rem; display: flex; justify-content: space-between; font-size: 0.8rem;">
                            <span>preview_kinetik_report.pdf</span>
                            <div class="flex gap-2">
                                <span style="width: 10px; height: 10px; background: #ef4444; border-radius: 50%;"></span>
                                <span style="width: 10px; height: 10px; background: #f59e0b; border-radius: 50%;"></span>
                            </div>
                        </div>
                        <div class="card-body" style="flex: 1; font-family: 'Times New Roman', serif; color: #333;">
                            <h1 style="font-size: 1.5rem; margin-bottom: 0.5rem;">Kinetischer Report</h1>
                            <p style="font-size: 0.8rem; color: #666; margin-bottom: 2rem; font-family: sans-serif;">Erstellt am 24.10.2023 | Projekt Alpha</p>
                            
                            <h4 style="font-family: sans-serif; font-size: 0.8rem; font-weight: bold; text-transform: uppercase; color: #1e3a8a; border-bottom: 1px solid #eee; padding-bottom: 4px; margin-bottom: 8px;">1. Zusammenfassung</h4>
                            <p style="font-size: 0.9rem; line-height: 1.6; margin-bottom: 1.5rem;">
                                Die Experimente der Gruppe A zeigen eine Reaktion 1. Ordnung. Die Geschwindigkeitskonstante k beträgt im Mittel 0.045 min⁻¹.
                            </p>

                            <h4 style="font-family: sans-serif; font-size: 0.8rem; font-weight: bold; text-transform: uppercase; color: #1e3a8a; border-bottom: 1px solid #eee; padding-bottom: 4px; margin-bottom: 8px;">2. Parameter</h4>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1.5rem;">
                                <div style="background: #f8fafc; padding: 0.5rem; font-family: sans-serif;">
                                    <div style="font-size: 0.7rem; color: #64748b;">Rate Constant k</div>
                                    <div style="font-weight: bold;">0.045</div>
                                </div>
                                <div style="background: #f8fafc; padding: 0.5rem; font-family: sans-serif;">
                                    <div style="font-size: 0.7rem; color: #64748b;">Halbwertszeit</div>
                                    <div style="font-weight: bold;">15.4 min</div>
                                </div>
                            </div>
                        </div>
                        <div style="padding: 1rem; background: #f8fafc; border-top: 1px solid var(--border);">
                            <button class="btn btn-primary w-full">PDF Download</button>
                        </div>
                    </div>
                </div>
            `;
            container.appendChild(wrapper);
        }

        function startChat() {
            const win = document.getElementById('chat-window');
            const btn = document.getElementById('gen-btn');
            document.getElementById('chat-placeholder').style.display = 'none';
            btn.disabled = true;

            const addMsg = (role, text) => {
                const div = document.createElement('div');
                div.className = `chat-bubble ${role === 'bot' ? 'chat-bot' : 'chat-user'}`;
                div.innerHTML = text;
                win.appendChild(div);
                win.scrollTop = win.scrollHeight;
            };

            addMsg('bot', 'Ich analysiere die Ergebnisse...');
            
            setTimeout(() => {
                addMsg('bot', 'Eine Frage zu <b>Exp_004</b>: Bei t=15min gibt es eine Abweichung. War das eine technische Störung?');
                
                // Add quick replies
                const replyDiv = document.createElement('div');
                replyDiv.className = 'fade-in';
                replyDiv.style.marginTop = '1rem';
                replyDiv.innerHTML = `
                    <button class="btn btn-secondary" style="font-size: 0.8rem; margin-right: 0.5rem;" onclick="replyChat(this, 'Nein, nur Rauschen')">Nein, Rauschen</button>
                    <button class="btn btn-secondary" style="font-size: 0.8rem;" onclick="replyChat(this, 'Ja, Pumpenausfall')">Ja, Pumpenausfall</button>
                `;
                win.appendChild(replyDiv);
                win.scrollTop = win.scrollHeight;
            }, 1500);
        }

        window.replyChat = function(btnElem, text) {
            const win = document.getElementById('chat-window');
            btnElem.parentElement.remove(); // remove buttons
            
            const div = document.createElement('div');
            div.className = `chat-bubble chat-user`;
            div.innerHTML = text;
            win.appendChild(div);

            setTimeout(() => {
                const botDiv = document.createElement('div');
                botDiv.className = `chat-bubble chat-bot`;
                botDiv.innerHTML = 'Verstanden. Ich vermerke das im Report und korrigiere den Fit.';
                win.appendChild(botDiv);
                win.scrollTop = win.scrollHeight;
            }, 800);
        }

        // --- INIT ---
        updateStepper();
        renderView();

    </script>
</body>
</html>
